import createError from 'http-errors';
import * as userService from '../services/user.service.js';

export async function create(request, reply) {
  try {
    const created = await userService.createUser(request.body);
    reply.code(201).send(created);
  } catch (err) {
    if (err.code === 11000) {
      throw createError(409, 'Email already exists');
    }
    throw err;
  }
}

export async function list(request, reply) {
  const users = await userService.listUsers();
  return reply.send(users);
}

export async function getById(request, reply) {
  const user = await userService.getUserById(request.params.id);
  if (!user) throw createError(404, 'User not found');
  return reply.send(user);
}
