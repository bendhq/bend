import fp from 'fastify-plugin';
import { v4 as uuidv4 } from 'uuid';

async function requestIdPlugin(fastify) {
  fastify.addHook('onRequest', async (request, reply) => {
    const incoming = request.headers['x-request-id'];
    const id = incoming || uuidv4();
    request.id = id;
    reply.header('X-Request-Id', id);
  });
}

export default fp(requestIdPlugin, { name: 'request-id' });
