import dotenv from 'dotenv';
import Joi from 'joi';

dotenv.config();

const envSchema = Joi.object({
  PORT: Joi.number().default(4000),
  NODE_ENV: Joi.string().valid('development', 'production', 'test').default('development'),
  MONGO_URI: Joi.string().uri().required(),
  APP_NAME: Joi.string().default('myapp'),
  TRUST_PROXY: Joi.boolean().truthy('true').falsy('false').default(false),
  RATE_LIMIT_WINDOW_MS: Joi.number().default(60000),
  RATE_LIMIT_MAX: Joi.number().default(100),
  LOG_LEVEL: Joi.string().default('info')
}).unknown();

const { value: env, error } = envSchema.validate(process.env);
if (error) {
  // prefer throwing early in startup so process manager can restart or fail
  throw new Error(`Config validation error: ${error.message}`);
}

export default {
  port: env.PORT,
  nodeEnv: env.NODE_ENV,
  mongoUri: env.MONGO_URI,
  appName: env.APP_NAME,
  trustProxy: env.TRUST_PROXY,
  rateLimitWindowMs: env.RATE_LIMIT_WINDOW_MS,
  rateLimitMax: env.RATE_LIMIT_MAX,
  logLevel: env.LOG_LEVEL
};
